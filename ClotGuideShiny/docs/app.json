[{"name": "app.py", "content": "from shiny import App, render, ui, reactive\n  \napp_ui = ui.page_fluid(\n    {\"style\": \"background-color: rgba(169, 169, 169, 0.7)\"},\n    ui.div({\"style\": \"font-size: 300%;\"},\n        \"ClotGuide\",),\n    ui.navset_tab(\n        ui.nav(\"Guide\", \n            ui.input_switch(\"hepUsed\", \"Heparin Used?\"),\n            ui.input_numeric(\"exTestCT\", \"Ex-Test CT\", value = 0),\n            ui.input_numeric(\"exTestA10\", \"Ex-Test A10\", value= 0),\n            ui.input_numeric(\"fibTestA10\", \"Fib-Test A10\", value = 0),\n            ui.input_numeric(\"inTestCT\", \"In-Test CT\", value= 0),\n            ui.row(\n                ui.column(10, ui.output_ui(\"hepCTSlider\")),\n            ),\n            ui.input_action_button(\"go\",\"Go\", class_=\"btn-primary\"),\n            ui.row(\n                ui.column(10, ui.output_ui(\"result\")),\n            ),\n            ui.row(\n                ui.column(10, ui.output_ui(\"plateletsandfibrinogen\")),\n            ),\n            ui.row(ui.div(\"---------\")),\n            ui.row(\n                ui.column(10, ui.output_ui(\"clottingTime\")),\n            ),\n            ui.row(\n                ui.column(10, ui.input_action_link(\"key\", \"Key\"))\n            ),\n        ),\n        ui.nav(\"More\",\n               ui.row(ui.input_action_link(\"about\", \"About\")),\n               ui.row(ui.input_action_link(\"show\", \"Disclaimer\")),\n               \n                   )\n        \n    )\n)\n\n\ndef server(input, output, session):\n    @output\n    @render.ui\n    def hepCTSlider():\n        if input.hepUsed():\n            return ui.TagList(\n                ui.input_numeric(\"hiTestCT\", \"Hi-Test CT\", value=0),\n            )\n\n    @output\n    @render.ui\n    @reactive.event(input.go)\n    def result():\n        if input.hepUsed():\n            if input.inTestCT() >= (228) and input.hiTestCT() <= (211.0):\n                hep = ui.div(\n                    {\"style\": \"font-weight: bold; color: red\"},\n                    \"\",\n                           )\n            else:\n                hep = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Heparin Effect\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: green\"},\n                    \"Unlikely Heparin Effect\",\n                           )),ui.row(ui.div(\"---------\"))\n            return hep\n            \n\n    @output\n    @render.ui\n    @reactive.event(input.go)\n    def plateletsandfibrinogen():\n        if input.exTestA10() < 22:\n        \n        \n            if input.fibTestA10() < 8:\n                plt = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Fibrinogen and Platelets\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: red\"},\n                    \"Very Low Fibrinogen and Platelets\",\n                           ))\n            \n            \n        elif input.exTestA10() < 39:\n        \n        \n            if input.fibTestA10() < 5:\n                plt = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Fibrinogen and Platelets\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: red\"},\n                    \"Very Low Fibrinogen, Low Platelets\",\n                ))\n            \n            elif input.fibTestA10() < 8:\n                plt = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Fibrinogen and Platelets\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: orange\"},\n                    \"Low Platelets and Fibrinogen\",\n                           ))\n                \n            else:\n                plt = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Fibrinogen and Platelets\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: orange\"},\n                    \"Low Platelets\",\n                           ))\n                \n        else:\n        \n        \n            if input.fibTestA10() < 5:\n               plt = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Fibrinogen and Platelets\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: orange\"},\n                    \"Low Fibrinogen\",\n                           ))\n            elif input.fibTestA10() < 10:\n                plt = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Fibrinogen and Platelets\",\n                           )),ui.row(ui.div({\"style\": \"font-weight: bold; color: green\"},\n                    \"OK Platelets and Fibrinogen*\")),ui.row(ui.div(\"*if ongoing bleeding may require more Fibrinogen\"))\n            else:\n                plt = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Fibrinogen and Platelets\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: green\"},\n                    \"OK Platelets and Fibrinogen\",\n                          ))\n                    \n            \n            \n        return plt\n\n    @output\n    @render.ui\n    @reactive.event(input.go)\n    def clottingTime():\n        if input.hepUsed() and (input.inTestCT() >= (228) and input.hiTestCT() <= (211.0)):\n            cf = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Clotting Time Analysis\",\n                           )),ui.row(ui.div(\n                {\"style\": \"font-weight: bold; color: red\"},\n                \"Likely Residual Heparin Effect\",\n            ))\n        elif input.fibTestA10() < 5:\n            cf = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Clotting Time Analysis\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: red\"},\n                    \"Low Fibringoen\",\n                           ))\n                \n        else:\n            if input.inTestCT() > 240 or input.exTestCT() > 80:\n                cf = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Clotting Time Analysis\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: orange\"},\n                    \"Low Clotting Factors\",\n                ))\n            else:\n                cf = ui.row(ui.div(\n                    {\"style\": \"font-weight: bold\"},\n                    \"Clotting Time Analysis\",\n                           )),ui.row(ui.div(\n                    {\"style\": \"font-weight: bold; color: green\"},\n                    \"Clotting Time OK\",\n                ))\n    \n        return cf\n\n    @reactive.Effect\n    @reactive.event(input.show)\n    def _():\n        m = ui.modal(\n            ui.HTML(\"This project is only to be used as a guide to interpreting ROTEM and ClotPro.<br>It is based on NHS Lothian's ROTEM/ClotPro Algorithm v1.11.<br>This is NOT a substitute for clinical judgement, nor is it intended to advise what treatment to give. Treatment plans should incorporate knowledge of the clinical picture.<br><br>If the advice seems incorrect, re-assess and escalate to a senior member of staff.<br><br>ClotGuide is intended to be used ONLY by trained professionals.<br><br>If you are unsure how to use this guide, seek senior help.\"),\n            title=\"Disclaimer\",\n            easy_close=True,\n            footer=None,\n        )\n        ui.modal_show(m)\n\n    @reactive.Effect\n    @reactive.event(input.key)\n    def _():\n        m = ui.modal(\n            ui.HTML(\"<h1 style=color:red;>RED: Significant</h1><br><h1 style=color:orange;>Orange: Significant if Bleeding or High Risk of Bleeding</h1><br><h1 style=color:green;>GREEN: Rule out other causes of coagulopathy*</h1><br>*ROTEM/ClotPro does not detect the effect of Antiplatelets<br>*ROTEM/ClotPro has poor sensitivity for LMWH, Warfarin, DOACs\"),\n            title=\"Key\",\n            easy_close=True,\n            footer=None,\n        )\n        ui.modal_show(m)\n        \n    @reactive.Effect\n    @reactive.event(input.about)\n    def _():\n        m = ui.modal(\n            ui.HTML(\"<h1>ClotGuide</h1><br><h4>Version 1.0</h4><br>ClotGuide was written by Nicholas Clinch<br><br>Currently Maintained by: Nicholas Clinch<br><br>Based on <i>NHS Lothian ROTEM/ClotPro Guidance Version 1.11</i><br>Last Updated: 18/08/2021\"),\n            title=\"About\",\n            easy_close=True,\n            footer=None,\n        )\n        ui.modal_show(m)\n\napp = App(app_ui, server)\n\n", "type": "text"}]